%\documentclass[letterpaper,draft]{beamer}
\documentclass[letterpaper,handout]{beamer}
%\documentclass[letterpaper]{beamer}

%---multiple pages on one sheet, ADD for handout--
%\usepackage{pgfpages}
%\pgfpagesuselayout{4 on 1}[letterpaper, landscape, border shrink=1mm]
%-------------------------------------------------
\usepackage{amsmath,amsfonts}
%\usepackage{booktabs}
%\usepackage{mdwlist}
\usepackage{amsfonts}
%\usetheme{Copenhagen}
%\usetheme{warsaw}
\setbeamertemplate{navigation symbols}{}
\usepackage[english]{babel}
\def\ul{\underline}
% or whatever

\usepackage[latin1]{inputenc}
\subject{Talks}

\def\Sum{\sum\nolimits}
\def\Prod{\prod\nolimits}
\def\p{\mathrm P}
\def\E{\mathbb E}
\def\V{\mathrm Var}
\def\CV{\mathrm Cov}
\def\X{\mathcal{X}}
\def\dt{\Delta}
\def\typo#1{\alert{#1}}
%-------------Answers------------
\def\Hide#1#2{\ul{~~~\onslide<#1>{\alert{#2}}~~~}}
\def\hide#1#2{\ul{~~\onslide<#1>{\alert{#2}}~~}}
\def\hid#1#2{\onslide<#1>{\alert{#2}}}
%------Centered Page Number------
\input{Centerpgn}
\def\chapnum{19}
%--------------------------------
\setbeamertemplate{footline}[centered page number]

\title{STAT253/317 Winter 2021 Lecture \chapnum} \date{February 24, 2014} \author{Yibi Huang}
\begin{document}
% ----------------------------------------------------------------------
%\begin{frame}
%\maketitle
%\begin{center}\large
%\begin{tabular}{ll}
%Chapter 8   & Queueing Models
%\end{tabular}
%\end{center}
%\end{frame}
% ----------------------------------------------------------------------
\begin{frame}{Chapter 8\; Queueing Models}
A queueing model consists ``customers'' arriving to receive some service and then depart. The mechanisms involved are
\begin{itemize}
\item input mechanism: the arrival pattern of customers in time
\item queueing mechanism: the number of servers, order of the service
\item service mechanism: the time to serve one or a batch of customers
\end{itemize}
We consider queueing models that follow the most common rule of service: \textbf{first come, first served.}
\end{frame}
% ----------------------------------------------------------------------
\begin{frame}{Common Queueing Processes}
It is often reasonable to assume
\begin{itemize}
\item the interarrival times of customers are i.i.d. (the arrival of customers follows a renewal process),
\item the service times for customers are i.i.d. and are independent of the arrival of customers.
\end{itemize}

Notation: $M=$ memoryless, or Markov, $G=$ General
\begin{itemize}
\item $M/M/1$: Poisson arrival, service time $\sim Exp(\mu)$, 1 server\\
= a birth and death process with birth rates $\lambda_j\equiv \lambda$, and death rates $\mu_j\equiv \mu$
\item $M/M/\infty$: Poisson arrival, service time $\sim Exp(\mu)$, $\infty$ servers\\
= a birth and death process with birth rates $\lambda_j\equiv \lambda$, and death rates $\mu_j\equiv j\mu$
\item $M/M/k$: Poisson arrival, service time $\sim Exp(\mu)$, $k$ servers\\
= a birth and death process with birth rates $\lambda_j\equiv \lambda$, and death rates $\mu_j\equiv \min(j,k)\mu$
\end{itemize}
\end{frame}
% ----------------------------------------------------------------------
\begin{frame}{Common Queueing Processes (Cont'd)}
\begin{itemize}
\itemsep=12pt
\item $M/G/1$: Poisson arrival, General service times $\sim G$, 1 server
\item $M/G/\infty$: Poisson arrival, General service time $\sim G$, $\infty$ servers
\item $M/G/k$: Poisson arrival, General service times $\sim G$, $k$ servers
\item $G/M/1$: General interarrival times, service times $\sim Exp(\mu)$, 1 server
\item $G/G/k$: General interarrival times $\sim F$, General service times $\sim G$, $k$ servers
\item $\ldots$
\end{itemize}
\end{frame}
% ----------------------------------------------------------------------
\begin{frame}{Quantities of Interest for Queueing Models}
Let
\begin{align*}
X(t) &= \text{\# of customers in the system at time }t\\
Q(t) &= \text{\# of customers waitng in queue at time }t
\end{align*}
Assume that $\{X(t), t \ge 0\}$ and $\{Q(t), t \ge 0\}$ has a stationary distribution.
\begin{align*}
L&=\lim_{t\to\infty}\frac{\int_0^t X(t)dt}{t}=\text{the  average \# of customers in the system}\\
L_Q&=\lim_{t\to\infty}\frac{\int_0^t Q(t)dt}{t}=\text{the average \# of customers waiting in queue}\\
W&=\text{the average amount of time, including waiting time }\\
 &\qquad\text{and service time, a customer spends in the system;}\\
W_Q&=\text{the average amount of time a customer waiting in queue.}
\end{align*}
\end{frame}
% ----------------------------------------------------------------------
\begin{frame}{Little's Formula}
Let
$$N(t) = \text{\# of customers enter the system at or before time }t.$$
We define $\lambda_a$ be the arrival rate of entering customers,
$$
\lambda_a=\lim_{t\to\infty}\frac{N(t)}{t}
$$
\textbf{Little's Formula:}
\begin{align*}
L &=\lambda_a W\\
L_Q &=\lambda_a W_Q
\end{align*}
\end{frame}
% ----------------------------------------------------------------------
\begin{frame}{Cost Identity}
Many interesting and useful relationships between quantities in Queueing models can be obtained by using the \structure{\bf cost identity}.\smallskip

Imagine that entering customers are forced to pay money (according to some
rule) to the system. We would then have the following basic cost identity:
\begin{align*}
&\text{average rate at which the system earns}\\
={}&\lambda_a\times \text{average amount an entering customer pays}
\end{align*}
{\em Proof.} Let $R(t)$ be the amount of money the system has earned by time $t$. Then we have
\begin{align*}
&\text{average rate at which the system earns}\\
&=\lim_{t\to\infty}\frac{R(t)}{t}=\lim_{t\to\infty}\frac{N(t)}{t}\frac{R(t)}{N(t)}
=\lambda_a\lim_{t\to\infty}\frac{R(t)}{N(t)}\\
&=\lambda_a\times \text{average amount an entering customer pays},
\end{align*}
provided that the limits exist.
\end{frame}
% ----------------------------------------------------------------------
\begin{frame}{Proof of Little's Formula}
%By choosing appropriate payment rules, we can use the Cost Identity to prove the two Little's Formulas.

To prove $L=\lambda_a W$:
\begin{itemize}
\item we use the payment rule:
$$\text{\fbox{each customer pays \$1 per unit time while in the system.}}$$
\item the average amount a customer pay $= W$, the average waiting time of customers.
\item the amount of money the system earns during the time interval $(t,t+\dt t)$ is $X(t)\dt t$, where $X(t)$ is the number of customers in the system at time $t$ ,
\item and the rate the system earns is thus $\displaystyle\lim_{t\to\infty}\frac{\int_0^{t}X(s)ds}{t}=L,$
the formula follows from the cost identity.
\end{itemize}
\medskip\hrule\medskip
To prove $L_Q=\lambda_a W_Q$, we use the payment rule:
$$\text{\fbox{each customer pays \$1 per unit time while in queue.}}$$
The argument is similar.
\end{frame}
% ----------------------------------------------------------------------
\begin{frame}{8.3.1 M/M/1 Model}
Let $X(t)$ be number of customers in the system at time $t$.
$\{X(t), t \ge 0\}$ is a birth and death process with
$$\text{birth rates }\lambda_j\equiv \lambda,\quad\text{and death rates }\mu_j\equiv \mu.$$
Recall in Example 6.14 we have showed that the stationary distribution exists when $\lambda<\mu$, and the stationary distribution is
$$
P_n=\lim_{t\to\infty}\p(X(t)=n)=\left(1-\frac{\lambda}{\mu}\right)\left(\frac{\lambda}{\mu}\right)^n,\quad n=0,1,\ldots
$$
Thus
\begin{align*}
L\!=\!\lim_{t\to\infty}\E[X(t)]\!=\!\sum_{n=1}^{\infty}nP_n\!=\!\frac{\lambda}{\mu-\lambda}&=\!\frac{1/\mu}{1/\lambda-1/\mu}\\
&=\frac{\E[\text{\small service time}]}{\E[\text{\small interarrival time}]\!-\!\E[\text{\small service time}]}
\end{align*}

\end{frame}
% ----------------------------------------------------------------------
\begin{frame}{8.3.1 M/M/1 Model (Cont'd)}
Let $T$ be the time of a customer spend in the system. \par
If there are $n$ customers in the system while this customer arrives,
then$T$ is the sum of the service times of the $n+1$ customers $\sim Gamma(n+1,\mu).$
That is,
\begin{align*}
\p(T\le t)&=\Sum_{n=0}^{\infty}P_n\int_0^t\frac{\mu^{n+1}}{n!}s^ne^{-\mu s}ds\\
&=\Sum_{n=0}^{\infty}\left(1-\frac{\lambda}{\mu}\right)\left(\frac{\lambda}{\mu}\right)^n\int_0^t\frac{\mu^{n+1}}{n!}s^ne^{-\mu s}ds\\
&=(\mu-\lambda)\int_0^t\bigg(\underbrace{\Sum_{n=0}^{\infty}\frac{(\lambda s)^{n}}{n!}}_{=e^{\lambda s}}\bigg)e^{-\mu s}ds\\[-3pt]
&=(\mu-\lambda)\int_0^t e^{-(\mu-\lambda)s}ds=1-e^{-(\mu-\lambda)t}
\end{align*}
Therefore,
$T\sim Exp(\mu-\lambda)\quad \Rightarrow\quad W=\E[T]=\dfrac{1}{\mu-\lambda}.$\par
This verifies Little's formula, $L=\lambda W.$
\end{frame}
% ----------------------------------------------------------------------
\begin{frame}{8.3.1 M/M/1 Model (Cont'd)}
\[
W_Q = W - \E[\text{service time}]=W-1/\mu=\frac{\lambda}{\mu(\mu-\lambda)}
%L_Q &=\lambda W_Q = \frac{\lambda^2}{\mu(\mu-\lambda)}
\]
Note that
\begin{center}
\# of customers in queue $=$ max(0, \# of customers in system$-1)$.
\end{center}

So
\begin{align*}
L_Q =\Sum_{n=1}^{\infty}(n-1)P_n&=\underbrace{\Sum_{n=1}^{\infty}nP_n}_{L}-(\underbrace{\Sum_{n=1}^{\infty}P_n}_{1-P_0})\\
&=L-1+P_0\\
&=\frac{\lambda}{\mu-\lambda}-1+\left(1-\frac{\lambda}{\mu}\right)\\
&=\frac{\lambda^2}{\mu(\mu-\lambda)}=\lambda W_Q
\end{align*}


\end{frame}
% ----------------------------------------------------------------------
\begin{frame}{Example 8.2}

Suppose customers arrive at a Poisson rate of 1 in 12 minutes, and that the service time is exponential at a rate of one service per 8 minutes. What are $L$ and $W$?

{\em Solution}. Since $\lambda=1/12$, $\mu=1/8$, we have
$$L=\frac{1/\mu}{1/\lambda-1/\mu}=\frac{8}{12-8}=2,\; W=\frac{1}{\mu-\lambda}=24$$
Observe if the arrival rate increases 20\% to $\lambda= 1/10$, then
$$L = 4, W= 40$$
When $\lambda/\mu\approx 1$, a slight increase in $\lambda/\mu$ will lead to a large increase in $L$ and $W$.
\end{frame}
% ----------------------------------------------------------------------
\begin{frame}{$M/M/\infty$ Model}
In this case, customers will be served immediately upon arrival. Nobody will be in queue. We have
$$W_Q=L_Q=0,\quad W=\text{average service time}=1/\mu,$$
and hence $L=\lambda W =\lambda/\mu.$\medskip

As a verification, observe that $\{X(t), t \ge 0\}$ is a birth and death process with
$$\text{birth rates }\lambda_j\equiv \lambda,\quad\text{and death rates }\mu_j\equiv j\mu.$$
The stationary distribution is
$$
P_n=\frac{\lambda^n}{n!\mu^n}P_0
=\frac{\lambda^n}{n!\mu^n}\frac{1}{\sum_{n=0}^{\infty}\frac{\lambda^n}{n!\mu^n}}
=e^{-\lambda/\mu}\frac{(\lambda/\mu)^n}{n!},\quad n=0,1,\ldots
$$
Therefore $X(t)\sim Poisson(\lambda/\mu)$ as $t\to\infty,$
$$L = \E[X(t)]=\lambda/\mu.$$
\end{frame}
% ----------------------------------------------------------------------
\begin{frame}{Birth \& Death Queueing Models}
%If the interarrival times of customers and service time are both independent exponential, and the system serves customers one by one, the queue model is a birth and death process.

In addition to $M/M/1$ and $M/M/\infty$ models, a more general family of birth \& death queueing models is the following:\medskip


\textbf{$M/M/k$ Queueing System with Balking}

Consider a $M/M/k$ system, but suppose a customer arrives finding $n$ others in the system will only join the system with probability $\alpha_n$, i.e., he balks (walks away) w/ prob. $1-\alpha_n$. This system is a birth and death process with
\begin{align*}
\lambda_n&=\lambda\alpha_n,\quad n\ge 0\\
\mu_n&=\min(n,k)\mu,\quad n\ge 1
\end{align*}
A special case of $M/M/k$ queueing system with balking is the $M/M/k$ system with finite capacity $N$, where
$$
\alpha_n=
\begin{cases}
1 & \text{if } n< N\\
0 & \text{if } n\ge N
\end{cases}
$$
\end{frame}
% ----------------------------------------------------------------------
\begin{frame}{Birth \& Death Queueing Models}
For a birth \& death queueing model,
the stationary distribution of the number of customers in the system is given by
$$
P_k=\lim_{t\to\infty}\p(X(t)=k)=\frac{\lambda_{0}\lambda_{1}\cdots\lambda_{k-1}/(\mu_{1}\mu_{2}\cdots\mu_{k})}{1+\sum_{n=1}^{\infty}\frac{\lambda_{0}\lambda_{1}\cdots\lambda_{n-1}}{\mu_{1}\mu_{2}\cdots\mu_{n}}},\quad k\ge 1
$$
The necessary and sufficient condition for such a stationary distribution to exists is that
$$
\sum_{n=1}^{\infty}\frac{\lambda_{0}\lambda_{1}\cdots\lambda_{n-1}}{\mu_{1}\mu_{2}\cdots\mu_{n}}< \infty.
$$
With $\{P_n\}$, the average number of customers in the system is simply
$$L=\Sum_{n=0}^{\infty} n P_n.$$
\end{frame}
% ----------------------------------------------------------------------
\begin{frame}{Birth \& Death Queueing Models (Cont'd)}
With balking, the rate that customers enter the system is not $\lambda$ (since not all customers enter the system), but
$$\lambda_a=\Sum_{n=0}^{\infty} \lambda_n P_n.$$
Consequently, the average waiting time is
$$W=L/\lambda_a=\frac{\Sum_{n=0}^{\infty} n P_n}{\Sum_{n=0}^{\infty} \lambda_n P_n},$$
and the average amount of time waiting in queue ($W_Q$) and average number of customers in queue ($L_Q$) are respectively
\begin{align*}
W_Q &= W - \E[\text{service time}]=W-(1/\mu),\\
L_Q &=\lambda_a W_Q
\end{align*}
\end{frame}
% ----------------------------------------------------------------------
\begin{frame}{Busy Period in a Birth \& Death Queueing Model}
There is a alternating renewal process embedded in a birth \& death queueing model.

We say a renewal occurs if the system become empty.%
%, then the system idles for a period of time until the next customer enters the system, and then a busy period begins until the system become empty again.

Using the alternating renewal theory, the long-run proportion of time that the system is empty is
$\dfrac{\E[\text{Idle}]}{\E[\text{Idle}]+\E[\text{Busy}]},$
where
\begin{align*}
\E[\text{Idle}]&=\text{expected length of an idle period}\\
\E[\text{Busy}]&=\text{expected length of a busy period}
\end{align*}
%\end{frame}
% ----------------------------------------------------------------------
%\begin{frame}{Busy Period in a Birth \& Death Queueing Model (Cont'd)}
Also note that the long-run proportion of time that the system is empty is simply $P_0=\lim_{t\to\infty}\p(X(t)=0)$.
Since the length of an idle period $\sim Exp(\lambda_0)$, we have $\E[\text{Idle}]=1/\lambda_0.$
In summary, we have that
$$
P_0=\frac{1/\lambda_0}{(1/\lambda_0)+\E[\text{Busy}]}
$$
or
$$
\E[\text{Busy}]=\frac{1-P_0}{\lambda_0 P_0}
$$
\end{frame}
% ----------------------------------------------------------------------
\end{document}
\begin{frame}{}
\end{frame}
% ----------------------------------------------------------------------
\begin{frame}
\end{frame}
